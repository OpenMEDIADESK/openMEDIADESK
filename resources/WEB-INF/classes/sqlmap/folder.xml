<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap
  PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
  "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Folder">

    <select id="getFolderById" parameterClass="int" resultClass="com.stumpner.mediadesk.image.folder.FolderMultiLang">
        SELECT
            folderid        as folderId,
            foldertitle     as folderTitle,
            foldername      as folderName,
            createdate      as createDate,
            createuserid    as createUserId,
            primaryivid     as primaryIvid,
            folderdate      as folderDate,
            foldersubtitle  as folderSubTitle,
            sortby          as sortBy,
            orderby         as orderBy,
            
            foldertitlelng1  as folderTitleLng1,
            foldertitlelng2  as folderTitleLng2,
            foldersubtitlelng1  as folderSubTitleLng1,
            foldersubtitlelng2  as folderSubTitleLng2
        FROM folder
        WHERE folderid = #value#
    </select>
    
    <select id="getFolderByName" parameterClass="java.lang.String" resultClass="com.stumpner.mediadesk.image.folder.FolderMultiLang">
        SELECT
            folderid        as folderId,
            foldertitle     as folderTitle,
            foldername      as folderName,
            createdate      as createDate,
            createuserid    as createUserId,
            primaryivid     as primaryIvid,
            folderdate      as folderDate,
            foldersubtitle  as folderSubTitle,
            sortby          as sortBy,
            orderby         as orderBy,

            foldertitlelng1  as folderTitleLng1,
            foldertitlelng2  as folderTitleLng2,
            foldersubtitlelng1  as folderSubTitleLng1,
            foldersubtitlelng2  as folderSubTitleLng2
        FROM folder
        WHERE foldername = #value#
    </select>

    <resultMap id="folderList" class="com.stumpner.mediadesk.image.folder.FolderMultiLang">
        <result property="folderId" column="folderid"/>
        <result property="folderTitle" column="foldertitle"/>
        <result property="folderName" column="foldername"/>
        <result property="createDate" column="createdate"/>
        <result property="createUserId" column="createuserid"/>
        <result property="primaryIvid" column="primaryivid"/>
        <result property="folderSubTitle" column="foldersubtitle"/>
        <result property="sortBy" column="sortby"/>
        <result property="orderBy" column="orderby"/>
        <result property="folderDate" column="folderdate"/>
        <result property="imageCount" column="imagecount"/>

        <result property="folderTitleLng1" column="foldertitlelng1"/>
        <result property="folderTitleLng2" column="foldertitlelng2"/>
        <result property="folderSubTitleLng1" column="foldersubtitlelng1"/>
        <result property="folderSubTitleLng2" column="foldersubtitlelng2"/>
        <result property="usedLanguage" column="usedLanguage"/>
    </resultMap>
    <statement id="getFolderList" parameterClass="com.stumpner.mediadesk.image.folder.FolderLoaderClass" resultMap="folderList">
        SELECT  folder.folderid,
                foldertitle,
                foldername,
                createdate,
                createuserid,
                primaryivid,
                foldersubtitle,
                folderdate,
                foldertitlelng1,
                foldertitlelng2,
                foldersubtitlelng1,
                foldersubtitlelng2,
                sortby,
                orderby,
                 '$usedLanguage$' as usedLanguage,
                count(fhid) as imagecount
            FROM folder
         LEFT OUTER JOIN folderholder ON folder.folderid = folderholder.folderid
         GROUP BY folder.folderid
         <isEqual compareValue="0" property="folderOrder">
         ORDER BY createdate DESC
         </isEqual>
         <isEqual compareValue="1" property="folderOrder">
         ORDER BY folderdate DESC
         </isEqual>
    </statement>

    <statement id="getVisibleFolderList" parameterClass="com.stumpner.mediadesk.image.folder.FolderLoaderClass" resultMap="folderList">
        SELECT  folder.folderid,
                foldertitle,
                foldername,
                createdate,
                createuserid,
                primaryivid,
                foldersubtitle,
                folderdate,
                foldertitlelng1,
                foldertitlelng2,
                foldersubtitlelng1,
                foldersubtitlelng2,
                sortby,
                orderby,
                 '$usedLanguage$' as usedLanguage,
                count(fhid) as imagecount
            FROM folder
         LEFT OUTER JOIN folderholder ON folder.folderid = folderholder.folderid
         GROUP BY folder.folderid
         HAVING count(fhid) > 0
         <isEqual compareValue="0" property="folderOrder">
         ORDER BY createdate DESC
         </isEqual>
         <isEqual compareValue="1" property="folderOrder">
         ORDER BY folderdate DESC
         </isEqual>
    </statement>

    <statement id="getFolderListFromImageVersion" parameterClass="com.stumpner.mediadesk.image.folder.FolderLoaderClass" resultMap="folderList">
        SELECT  folder.folderid,
                foldertitle,
                foldername,
                createdate,
                createuserid,
                primaryivid,
                foldersubtitle,
                folderdate,
                foldertitlelng1,
                foldertitlelng2,
                foldersubtitlelng1,
                foldersubtitlelng2,
                sortby,
                orderby,
                 '$usedLanguage$' as usedLanguage,
                count(fhid) as imagecount
            FROM folder
         LEFT OUTER JOIN folderholder ON folder.folderid = folderholder.folderid
         WHERE folderholder.ivid = #id#
         GROUP BY folder.folderid
         ORDER BY createdate DESC
    </statement>

    <select id="getMaxFolderId"
        parameterClass="int"
        resultClass="int">
        SELECT
            MAX(folderid) as value
        FROM folder
    </select>

    <insert id="addFolder" parameterClass="com.stumpner.mediadesk.image.folder.FolderMultiLang">
        INSERT INTO
        folder (foldertitle,foldername,createdate,createuserid,primaryivid,foldersubtitle,folderdate,foldertitlelng1,foldersubtitlelng1,foldertitlelng2,foldersubtitlelng2)
        VALUES (#folderTitle#,#folderName#,#createDate#,#createUserId#,#primaryIvid#,#folderSubTitle#,#folderDate#,#folderTitleLng1#,#folderSubTitleLng1#,#folderTitleLng2#,#folderSubTitleLng2#)
    </insert>

    <insert id="addImageToFolder" parameterClass="com.stumpner.mediadesk.image.folder.FolderHolder">
        INSERT INTO
        folderholder (folderid,ivid,imagetitlealias)
        VALUES (#folderId#,#ivid#,#imageTitleAlias#)
    </insert>

    <delete id="deleteImageFromFolder" parameterClass="com.stumpner.mediadesk.image.folder.FolderHolder">
        DELETE FROM folderholder
        WHERE folderid = #folderId# AND ivid = #ivid#
    </delete>
    
    <delete id="deleteImageFromAllFolders" parameterClass="int">
        DELETE FROM folderholder
        WHERE ivid = #ivid#
    </delete>

    <delete id="deleteAllImagesFromFolder" parameterClass="int">
        DELETE FROM folderholder
        WHERE folderid = #folderId#
    </delete>

    <delete id="deleteFolderById" parameterClass="int">
        DELETE FROM folder
        WHERE folderid = #folderId#
    </delete>

    <update id="saveFolder" parameterClass="com.stumpner.mediadesk.image.folder.FolderMultiLang">
        UPDATE folder
        SET foldertitle = #folderTitle#,
            foldername = #folderName#,
            primaryivid = #primaryIvid#,
            folderdate = #folderDate#,
            foldersubtitle = #folderSubTitle#,
            foldertitlelng1 = #folderTitleLng1#,
            foldertitlelng2 = #folderTitleLng2#,
            foldersubtitlelng1 = #folderSubTitleLng1#,
            foldersubtitlelng2 = #folderSubTitleLng2#,
            sortby = #sortBy#,
            orderby = #orderBy#
        WHERE folderid = #folderId#
    </update>

    <select id="isImageInFolder"
        parameterClass="com.stumpner.mediadesk.core.database.sc.loader.HolderClass"
        resultClass="int">
        SELECT
            COUNT(*) as value
        FROM folderholder WHERE folderid = #objectId# AND ivid = #ivid#
    </select>

</sqlMap>